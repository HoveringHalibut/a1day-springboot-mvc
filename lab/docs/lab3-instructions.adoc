:noaudio:
:scrollbar:
:data-uri:
:toc2:

== Lab 3 - Creating an OpenShift Test Release and A/B Test or Blue/Green Release Deployment

In this lab, we will use an OpenShift Template to replicate the product-catalog application deployment, using the *next-release* imagestream tag.  We will then review the ability of OpenShift Routes to split application network traffic across multiple OpenShift/K8S Services, enabling either A-B Test or Blue/Green Release Deployments.

:numbered:

== Create the product-catalog Test Deployment

In this step, we will use a YAML Template to generate a product-catalog Test deployment in our OpenShift project:

1. From the command line and where this project was cloned, navigate to the */lab/.openshift* directory
2. Ensure you are logged into OpenShift and your Lab Project, then execute the following *oc* command:
+
[source,bash]
----
oc process -f product-catalog-test-tmp.yaml | oc create -f -
----
+
If the command executed successfully, you should see the following output
+
[source,bash]
----
deploymentconfig "product-catalog-test" created
service "product-catalog-test" created
route "product-catalog-test" created
----
3. From the OpenShift Web console, you should now see a new instance of the Product Catalog application deployed as "product-catalog-test".  Use the newly created *Route* to verify the Application, it shares the same Postgres DB as the initial deployment:
+
image::https://github.com/ghoelzer-rht/ocp-rhoar-spring/blob/master/lab/images/spring-lab-release1.png[]

== Configure product-catalog-test for an A/B Test Deployment

In this step, we will update the the product catalog app and before releasing it, use the ability of OpenShift Routes to split traffic across multiple OpenShift K8S Services to implement an A/B Test Deployment:

1. Let's start by updating the version number in our Product Catalog List.  Edit the jsp page - /lab/src/main/resources/META-INF/resources/WEB-INF/jsp/productList.jsp and update the version number in the html *page-header* as shown below:
+
[source,xml]
----
<div class="page-header">
   <h1>Admin - Product List v1.01</h1>
</div>
----


